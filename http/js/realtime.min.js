function getFeeds(){$.getJSON("/feeds",function(a){var b=0;$.each(a,function(a,c){var d={id:"button"+b,open:!1};if(popup1[b]=d,c.sourceid.indexOf("@")>=0)var e='<a target="_blank" data-filter="'+c.message+'" id="button'+b+'" href="'+c.sourceid+'"  class="ba-0 px-0 py-0 square-corner list-group-item cursor-pointer list-group-item-action">'+feedsTemplate(c)+"</a>";else var e='<div data-filter="'+c.message+'" id="button'+b+'" data-popup="'+c.sourceid+'"  data-content="a" data-placement="left"  class="ba-0 px-0 py-0 square-corner list-group-item cursor-pointer feedsPopup list-group-item-action">'+feedsTemplate(c)+"</div>";$("#feeds-data").prepend(e),b++}),$("#feed-tab").scrollbar()}).done(function(){$(".feedsPopup").popover({html:!0})})}function getFeeds_new(){$.getJSON("/feeds/new",function(a){$.each(a,function(a,b){var c={id:"button"+popup1.length,open:!1};if(popup1[popup1.length]=c,b.sourceid.indexOf("@")>=0)var d='<a target="_blank" data-filter="'+b.message+'" id="button'+popup1.length+'" href="'+b.sourceid+'"  class="ba-0 px-0 py-0 square-corner list-group-item cursor-pointer  list-group-item-action">'+feedsTemplate(b)+"</a>";else var d='<div data-filter="'+b.message+'" id="button'+popup1.length+'" data-popup="'+b.sourceid+'"  data-content="a" data-placement="left"  class="ba-0 px-0 py-0 square-corner list-group-item cursor-pointer feedsPopup list-group-item-action">'+feedsTemplate(b)+"</div>";$("#feeds-data").prepend(d)})}).done(function(){$(".feedsPopup").popover({html:!0})})}function getNotification(){$.getJSON("/notification",function(a){var b=0,c="";$.each(a,function(a,d){if(d.sourceid.indexOf("@")>=0)var e='<a target="_blank" href="'+d.sourceid+'" class=" ba-0 px-1 my-1 py-0 square-corner list-group-item cursor-pointer ">'+notificationTemplate(d,d.count)+"</a>";else var e='<div data-slide="'+d.sourceid+'" class=" notificationMakeSlide ba-0 px-1 my-1 py-0 square-corner list-group-item cursor-pointer ">'+notificationTemplate(d,d.count)+"</div>";c+=e,1==d.count&&b++}),$("#notifications").html(c),b>0&&($("#notificationcount").hasClass("hidden-xs-up")&&($("#notificationcount").removeClass("hidden-xs-up"),$("#notificationTop").removeClass("hidden-xs-up")),$("#notificationcount").text(b),$("#notificationTop").text(b)),$("#notification-scroll").scrollbar()})}function getNotification_new(){$.getJSON("/notification/new",function(a){var b=0,c="";$.each(a,function(a,d){if(console.log(d),d.sourceid.indexOf("@")>=0)var e='<a target="_blank" href="'+d.sourceid+'" class=" ba-0 px-1 my-1 py-0 square-corner list-group-item cursor-pointer ">'+notificationTemplate(d,1)+"</a>";else var e='<div data-slide="'+d.sourceid+'" class=" notificationMakeSlide ba-0 px-1 my-1 py-0 square-corner list-group-item cursor-pointer ">'+notificationTemplate(d,1)+"</div>";c+=e,b++,alertSound(),Push.create(d.msg,{body:d.time,icon:d.user_picture,timeout:8e3,onClick:function(){window.focus(),this.close()}}),$("#notifications").prepend(c),b>0&&($("#notificationcount").removeClass("hidden-xs-up"),$("#notificationTop").removeClass("hidden-xs-up"),$("#notificationcount").text(parseInt($("#notificationcount").text())+b),$("#notificationTop").text(parseInt($("#notificationTop").text())+b))})})}function getRecent_chat(){$("#recent-chat").html(""),$.getJSON("/messages",function(a){var b=0;$.each(a[1],function(a,c){c.count>0&&(Rmessagelist[c.conversation_id]=[],b++);var d='<div data-filter="'+c.name+'" class="online_users-recent cursor-pointer list-group-item bx-0 ba-0 p-0 square-corner list-group-item-action"conversation-id="'+c.conversation_id+'" conversation-auth="'+c.auth+'" csrf-id="'+csrf+'" user-id="'+c.username+'">'+onlineTemplate1(c)+"</div>";$("#recent-chat").append(d)}),b>0&&($("#messagecount").html(b),$("#messagecountTop").html(b),$("#messagecount").hasClass("hidden-xs-up")&&($("#messagecount").removeClass("hidden-xs-up"),$("#messagecountTop").removeClass("hidden-xs-up")))}).done(function(){$("#recent-people").scrollbar()})}function getOnline(){$.getJSON("/online",function(a){var b="";$("#filter").val()&&(b=$("#filter").val());var c="";$.each(a[1],function(a,d){var e="";d.user_name.toLowerCase().indexOf(b.toLowerCase())<0&&b.length>0&&(e="style='display: none;'");var f='<form method="POST" action="/conversation" accept-charset="UTF-8" '+e+'><input name="_token" type="hidden" value="'+csrf+'"><input name="user_id" type="hidden" value="'+d.id+'"><input name="success" type="hidden" value="chat"><div data-filter="'+d.user_name+'" class="online_users cursor-pointer list-group-item bx-0 ba-0 p-0 square-corner list-group-item-action" >'+onlineTemplate(d)+"</div></form>";c+=f}),$("#online").html(c),$("#people").scrollbar()})}function getOnline1(){$.getJSON("/online",function(a){var b="";$("#filter1").val()&&(b=$("#filter1").val());var c="";$.each(a[1],function(a,d){var e="";d.user_name.toLowerCase().indexOf(b.toLowerCase())<0&&b.length>0&&(e="style='display: none;'");var f='<form method="POST" action="/conversation" accept-charset="UTF-8" '+e+'><input name="_token" type="hidden" value="'+csrf+'"><input name="user_id" type="hidden" value="'+d.id+'"><input name="success" type="hidden" value="chat-app"><div data-filter="'+d.user_name+'" class="online_users cursor-pointer list-group-item bx-0 ba-0 p-0 square-corner list-group-item-action" >'+onlineTemplate(d)+"</div></form>";c+=f}),$("#online1").html(c),$("#filter1").keyup(),$("#people2").scrollbar()})}function getSessionChat(){$.getJSON("/chatSession",function(a){$.each(a,function(a,b){chatlist.push(parseInt(b.id)),Rmessagelist[parseInt(b.id)]=[];var c=[];if(c.csrf=csrf,c.id=b.id,c.user_name=b.name,c.user_picture=b.picture,c.username="#",c.auth=b.auth,screen_size>989){$("#chatmanager").append(chatTemplate(c,!1,b)),$(".awesome-chat").draggable({scroll:!1});var d="#conversation_"+c.id;chatlist.push(c.id),Rmessagelist[c.id]=[],$(d).scrollbar(),$("input.chatBox1:text").next().hasClass("emojionearea")&&$("input.chatBox1:text").unbind(),$(".chatBox1").emojioneArea({pickerPosition:"top",autocomplete:!1,inline:!0}),$("input.chatBox1:text").each(function(a,b){$(this).next().next().hasClass("emojionearea")&&($(this).next().remove(),$(this).next().children().first().html(""),$(this).next().children().first().attr("placeholder","Message"))})}})})}function getMessages(){$.getJSON("/message",function(a){$.each(a,function(a,b){$.each(b,function(a,b){if(alertSound(),b.conversation_id=parseInt(b.conversation_id),-1==jQuery.inArray(b.conversation_id,chatlist)&&chat_app_conversation_id!=b.conversation_id){chatlist.push(b.conversation_id),Rmessagelist[b.conversation_id]=[];var c=[];if(c.user_picture=b.user_picture,c.user_name=b.user_name,c.username=b.username,c.csrf=csrf,c.id=b.conversation_id,c.auth=b.auth,-1!=b.id&&Rmessagelist[b.conversation_id].push(b.id),screen_size>989){$("#chatmanager").append(chatTemplate(c));var d="#conversation_"+b.conversation_id;if(!$(d).closest(".float-chat").is(":visible")){var e=parseInt($(d).closest(".float-chat").prev().children().last().find("span").html());$(d).closest(".float-chat").prev().children().last().find("span").html(e+1),$(d).closest(".float-chat").prev().children().last().find("span").removeClass("hidden-xs-up"),$(d).closest(".float-chat").prev().addClass("shake-chunk"),$(d).closest(".float-chat").prev().addClass("shake-constant"),$(d).closest(".float-chat").prev().addClass("shake-constant--hover"),Push.create(b.message,{body:b.time,icon:$(d).closest(".float-chat").prev().find("img").attr("src"),timeout:8e3,onClick:function(){window.focus(),this.close()}})}$(".awesome-chat").draggable({scroll:!1});var f="#conversation_"+c.id;$(f).scrollbar(),$("input.chatBox1:text").next().hasClass("emojionearea")&&$("input.chatBox1:text").unbind(),$(".chatBox1").emojioneArea({pickerPosition:"top",autocomplete:!1,inline:!0}),$("input.chatBox1:text").each(function(a,b){$(this).next().next().hasClass("emojionearea")&&($(this).next().remove(),$(this).next().children().first().html(""),$(this).next().children().first().attr("placeholder","Message"))})}}else if(screen_size>989||b.conversation_id==chat_app_conversation_id){var d="#conversation_"+b.conversation_id;if(-1!=b.id){if(Rmessagelist[b.conversation_id].push(b.id),!$(d).closest(".float-chat").is(":visible")){var e=parseInt($(d).closest(".float-chat").prev().children().last().find("span").html());$(d).closest(".float-chat").prev().children().last().find("span").html(e+1),$(d).closest(".float-chat").prev().children().last().find("span").removeClass("hidden-xs-up"),$(d).closest(".float-chat").prev().addClass("shake-chunk"),$(d).closest(".float-chat").prev().addClass("shake-constant"),$(d).closest(".float-chat").prev().addClass("shake-constant--hover"),b.conversation_id!=chat_app_conversation_id&&Push.create(b.message,{body:b.time,icon:$(d).closest(".float-chat").prev().find("img").attr("src"),timeout:8e3,onClick:function(){window.focus(),this.close()}})}$(d).find(".chat-content").append(messageTemplate(b,1)),b.conversation_id==chat_app_conversation_id&&jQuery("#chat-app-scroll").scrollTop(15e5),jQuery(d).scrollTop(15e5)}}SyncallMessage(b)})})})}function SyncallMessage(a,b){var c=0;$(".message_app_users").each(function(b,d){a.conversation_id==parseInt($(d).attr("conversation-id"))&&(c=$(d).children().children("li").last().find(".tag-primary").text(),$(d).remove())});var e="#conversation_"+a.conversation_id,f="";if(a.conversation_id!=chat_app_conversation_id&&!$(e).closest(".float-chat").is(":visible")){f='<span class="tag tag-primary tag-pill"> '+ ++c+" </span>";var g=0;$.each(Rmessagelist,function(a,b){b&&g++}),$("#messagecount").html(g),$("#messagecountTop").html(g),g>0&&$("#messagecount").hasClass("hidden-xs-up")&&($("#messagecount").removeClass("hidden-xs-up"),$("#messagecountTop").removeClass("hidden-xs-up"))}var h='<div  class="message_app_users cursor-pointer list-group-item p-0 bb-1 border-light square-corner list-group-item-action" conversation-id="'+a.conversation_id+'"  data-filter="'+a.user_name+'"  conversation-auth="'+a.auth+'"user-id="'+a.username+'"> <ul class="nav  nav-inline p-0_5 pr-0"> <li class="nav-item align-top "> <img class="rounded-circle pp-40" src="'+a.user_picture+'" alt="'+a.user_name+'"> </li> <li class="nav-item mx-0 online_width-s"> <div class="lh-1 pl-0_5 "> <p class="m-0 p-0 comment_link ">'+anonymousTagTemplate(a.user_name)+'</p> <small class="text-muted opensanN">'+smilies(TextLimit(a.message,15))+'</small> </div> </li> <li class="nav-item float-xs-right pl-0 pr-0">'+f+'<small class="text-muted opensanL"> '+a.time+"</small> </li> </ul> </div> ";$("#chat-app-scroll1").find(".list-group").prepend(h),c=0,$(".online_users-recent").each(function(b,d){a.conversation_id==parseInt($(d).attr("conversation-id"))&&(c=$(d).children().children("li").last().find(".tag-primary").text(),$(d).remove())}),f="",a.conversation_id==chat_app_conversation_id||$(e).closest(".float-chat").is(":visible")||(f='<span class="tag tag-primary tag-pill"> '+ ++c+" </span>"),h='<div  class="online_users-recent cursor-pointer list-group-item bx-0 ba-0 p-0 square-corner list-group-item-action" conversation-id="'+a.conversation_id+'"  data-filter="'+a.user_name+'"  conversation-auth="'+a.auth+'"user-id="'+a.username+'"  csrf-id="'+csrf+'"> <ul class="nav  nav-inline p-0_5 pr-0"> <li class="nav-item align-top "> <img class="rounded-circle pp-40" src="'+a.user_picture+'" alt="'+a.user_name+'"> </li> <li class="nav-item mx-0 online_width-s"> <div class="lh-1 pl-0_5 "> <p class="m-0 p-0 comment_link ">'+anonymousTagTemplate(a.user_name)+'</p> <small class="text-muted opensanN">'+smilies(TextLimit(a.message,15))+'</small> </div> </li> <li class="nav-item float-xs-right pl-0 ">'+f+'<small class="text-muted opensanL">'+a.time+"</small> </li> </ul> </div> ",$("#recent-chat").prepend(h)}function checkMessages(){$.each(messagelist,function(a,b){$.getJSON("/check-message/"+b,function(a){var c="#message-"+b,d=$(c).find(".detailmsg").parent();$(d).removeClass("chat-messageS"),$(d).removeClass("chat-messageD"),$(d).removeClass("chat-messageR"),$(d).addClass("chat-message"+a.status);var e=$(c).find(".detailmsg").text(),f=e.substring(0,e.length-1)+a.status;if($(c).find(".detailmsg").text(f),"R"==a.status){var g=messagelist.indexOf(parseInt(b));-1!=g&&messagelist.splice(g,1)}})})}function wait(a){for(var b=(new Date).getTime(),c=b;c<b+a;)c=(new Date).getTime()}function chatTyping(a){try{if(chat_app_conversation_id==a){var c="#conversation_"+a;$(c).prev().children().next().next().children().next().first().html(),$(c).prev().children().next().next().children().next().first().html("Typing..."),setTimeout(function(){$(c).prev().children().next().next().children().next().first().html("Online")},3e3)}else{var c="#conversation_"+a;$(c).parent().prev().children().next().next().first().html(),$(c).parent().prev().children().next().next().first().html("Typing..."),setTimeout(function(){$(c).parent().prev().children().next().next().first().html("Online")},3e3)}}catch(a){}}function chatPersons(){if($.each(chatlist,function(a,b){var c="";$.get("/chat-person/"+b,function(a){c=a;var d="#conversation_"+b;"Online"==c?($(d).parent().parent(".float-chat").children().first().children().next().next().first().removeClass("tag-warning"),$(d).parent().parent(".float-chat").children().first().children().next().next().first().addClass("tag-success")):($(d).parent().parent(".float-chat").children().first().children().next().next().first().removeClass("tag-success"),$(d).parent().parent(".float-chat").children().first().children().next().next().first().addClass("tag-warning")),$(d).parent().parent(".float-chat").children().first().children().next().next().first().html(c)})}),chat_app_conversation_id){var a="";$.get("/chat-person/"+chat_app_conversation_id,function(b){a=b,$("#chats-content").children().children("a").last().children("small").html(a)})}}function checkfacematch(){$.getJSON("/facematch",function(a){var b=0;$.each(a,function(a,c){if(0==b){$("#F_user_1_form").children("input").first().next().attr("value",c.facematch_id),$("#F_user_1_form").children("input").first().next().next().attr("value",c.id),$("#facematchModal").modal("show");var d=c.followers,e=c.following;$("#F_user_1_college").text(c.college_name_id+" - "+c.branch_id+" - "+c.college_year),$("#F_user_1_name").html('<a href="'+c.username+'">'+c.name+"</a>"),$("#F_user_1_detail").text("Followers "+d+" . Following "+e),$("#F_user_1_photo").attr("src",c.profile_picture_big)}else{$("#F_user_2_form").children("input").first().next().attr("value",c.facematch_id),$("#F_user_2_form").children("input").first().next().next().attr("value",c.id);var d=c.followers,e=c.following;$("#F_user_2_college").text(c.college_name_id+" - "+c.branch_id+" - "+c.college_year),$("#F_user_2_name").html('<a href="'+c.username+'">'+c.name+"</a>"),$("#F_user_2_detail").text("Followers "+d+" . Following "+e),$("#F_user_2_photo").attr("src",c.profile_picture_big)}b++})})}function alertSound(){if(screen_size>989){new Audio("/audio/alert.mp3").play()}}var messagelist=[],chatlist=[],chat_app_conversation_id,Rmessagelist=[],popup1=[];getNotification(),checkfacematch(),getOnline(),setInterval(getOnline,3e4),screen_size>989&&getFeeds();var pusher=new Pusher("9dbdbd3b88e6b4a2c2f0",{encrypted:!0}),channel=pusher.subscribe("fabits");channel.bind("universal",function(a){getFeeds_new(),getNotification_new()}),channel.bind("posts",function(a){if(!itsme){$("#new_posts").hasClass("hidden-xs-up")&&$("#new_posts").removeClass("hidden-xs-up"),$("#homecountTop").hasClass("hidden-xs-up")&&$("#homecountTop").removeClass("hidden-xs-up"),$("#homecount").hasClass("hidden-xs-up")&&$("#homecount").removeClass("hidden-xs-up");var b=parseInt($("#new_posts").html())+1;$("#new_posts").html(b+" new posts"),$("#homecountTop").html(b),$("#homecount").html(b)}});var channel2=pusher.subscribe("fabits"+$('meta[name="user_id"]').attr("content")+"notify");channel2.bind("notify",function(a){getNotification_new()});